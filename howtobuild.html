import React, { useState } from 'react';
import { Copy, Check, Database, Code, FileCode, Terminal, FolderPlus, Layers } from 'lucide-react';

export default function GORMGenGuide() {
  const [copiedIndex, setCopiedIndex] = useState(null);

  const copyToClipboard = (text, index) => {
    navigator.clipboard.writeText(text);
    setCopiedIndex(index);
    setTimeout(() => setCopiedIndex(null), 2000);
  };

  const codeBlocks = [
    {
      title: "Step 1: à¸ªà¸£à¹‰à¸²à¸‡ Project Structure",
      icon: <FolderPlus className="w-5 h-5" />,
      description: "à¸ªà¸£à¹‰à¸²à¸‡ folder structure à¹à¸šà¸šà¸¡à¸²à¸•à¸£à¸à¸²à¸™",
      code: `# à¸ªà¸£à¹‰à¸²à¸‡ project directory
mkdir myproject
cd myproject

# Initialize Go module
go mod init myproject

# à¸ªà¸£à¹‰à¸²à¸‡ folder structure
mkdir -p cmd/api
mkdir -p internal/database
mkdir -p internal/models
mkdir -p internal/handlers
mkdir -p internal/services
mkdir -p internal/middleware
mkdir -p pkg/utils
mkdir -p config
mkdir -p scripts`,
      language: "bash"
    },
    {
      title: "Step 2: à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ Dependencies",
      icon: <Terminal className="w-5 h-5" />,
      description: "à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ packages à¸—à¸µà¹ˆà¸ˆà¸³à¹€à¸›à¹‡à¸™",
      code: `go get -u gorm.io/gorm
go get -u gorm.io/driver/postgres
go get -u gorm.io/gen
go get -u github.com/joho/godotenv
go get -u github.com/gin-gonic/gin`,
      language: "bash"
    },
    {
      title: "Step 3: à¸ªà¸£à¹‰à¸²à¸‡à¹„à¸Ÿà¸¥à¹Œ .env",
      icon: <FileCode className="w-5 h-5" />,
      description: "Config à¸ªà¸³à¸«à¸£à¸±à¸š database à¹à¸¥à¸° app",
      code: `# Database Configuration
DB_HOST=localhost
DB_USER=postgres
DB_PASSWORD=yourpassword
DB_NAME=yourdatabase
DB_PORT=5432
DB_SSLMODE=disable

# Application Configuration
APP_PORT=8080
APP_ENV=development`,
      language: "env",
      filename: ".env"
    },
    {
      title: "Step 4: config/config.go",
      icon: <Code className="w-5 h-5" />,
      description: "à¸ˆà¸±à¸”à¸à¸²à¸£ configuration à¹à¸šà¸š centralized",
      code: `package config

import (
	"log"
	"os"

	"github.com/joho/godotenv"
)

type Config struct {
	Database DatabaseConfig
	App      AppConfig
}

type DatabaseConfig struct {
	Host     string
	User     string
	Password string
	DBName   string
	Port     string
	SSLMode  string
}

type AppConfig struct {
	Port string
	Env  string
}

func Load() *Config {
	// à¹‚à¸«à¸¥à¸” .env file
	if err := godotenv.Load(); err != nil {
		log.Println("âš ï¸ .env file not found, using environment variables")
	}

	return &Config{
		Database: DatabaseConfig{
			Host:     getEnv("DB_HOST", "localhost"),
			User:     getEnv("DB_USER", "postgres"),
			Password: getEnv("DB_PASSWORD", ""),
			DBName:   getEnv("DB_NAME", "mydb"),
			Port:     getEnv("DB_PORT", "5432"),
			SSLMode:  getEnv("DB_SSLMODE", "disable"),
		},
		App: AppConfig{
			Port: getEnv("APP_PORT", "8080"),
			Env:  getEnv("APP_ENV", "development"),
		},
	}
}

func getEnv(key, defaultValue string) string {
	if value := os.Getenv(key); value != "" {
		return value
	}
	return defaultValue
}`,
      language: "go",
      filename: "config/config.go"
    },
    {
      title: "Step 5: internal/database/database.go",
      icon: <Database className="w-5 h-5" />,
      description: "Database connection handler",
      code: `package database

import (
	"fmt"
	"log"
	"myproject/config"

	"gorm.io/driver/postgres"
	"gorm.io/gorm"
	"gorm.io/gorm/logger"
)

var DB *gorm.DB

func Connect(cfg *config.Config) error {
	dsn := fmt.Sprintf(
		"host=%s user=%s password=%s dbname=%s port=%s sslmode=%s",
		cfg.Database.Host,
		cfg.Database.User,
		cfg.Database.Password,
		cfg.Database.DBName,
		cfg.Database.Port,
		cfg.Database.SSLMode,
	)

	var err error
	DB, err = gorm.Open(postgres.Open(dsn), &gorm.Config{
		Logger: logger.Default.LogMode(logger.Info),
	})

	if err != nil {
		return fmt.Errorf("failed to connect database: %w", err)
	}

	log.Println("âœ… Connected to PostgreSQL successfully!")
	return nil
}

func GetDB() *gorm.DB {
	return DB
}`,
      language: "go",
      filename: "internal/database/database.go"
    },
    {
      title: "Step 6: scripts/generate.go",
      icon: <Code className="w-5 h-5" />,
      description: "Script à¸ªà¸³à¸«à¸£à¸±à¸š generate models (à¹à¸¢à¸à¸­à¸­à¸à¸ˆà¸²à¸ main app)",
      code: `package main

import (
	"log"
	"myproject/config"
	"myproject/internal/database"

	"gorm.io/gen"
)

func main() {
	// à¹‚à¸«à¸¥à¸” config
	cfg := config.Load()

	// à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ database
	if err := database.Connect(cfg); err != nil {
		log.Fatal("âŒ Database connection failed:", err)
	}

	db := database.GetDB()

	// Configure generator
	g := gen.NewGenerator(gen.Config{
		OutPath:       "./internal/models/query",
		Mode:          gen.WithoutContext | gen.WithDefaultQuery | gen.WithQueryInterface,
		FieldNullable: true,
		FieldCoverable: false,
	})

	g.UseDB(db)

	// Generate models à¸ˆà¸²à¸ ALL tables
	g.ApplyBasic(g.GenerateAllTable()...)

	// à¸«à¸£à¸·à¸­ generate à¹€à¸‰à¸à¸²à¸°à¸šà¸²à¸‡ tables
	// g.ApplyBasic(
	//     g.GenerateModel("users"),
	//     g.GenerateModel("products"),
	//     g.GenerateModel("orders"),
	// )

	// Execute generation
	g.Execute()

	log.Println("ğŸ‰ Models generated successfully in ./internal/models/query/")
}`,
      language: "go",
      filename: "scripts/generate.go"
    },
    {
      title: "Step 7: internal/services/user_service.go",
      icon: <Layers className="w-5 h-5" />,
      description: "Business logic layer (à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡)",
      code: `package services

import (
	"myproject/internal/models/query"
)

type UserService struct {
	query *query.Query
}

func NewUserService(q *query.Query) *UserService {
	return &UserService{query: q}
}

// à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡: Get all users
func (s *UserService) GetAllUsers() (interface{}, error) {
	users, err := s.query.User.Find()
	if err != nil {
		return nil, err
	}
	return users, nil
}

// à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡: Get user by ID
func (s *UserService) GetUserByID(id int) (interface{}, error) {
	user, err := s.query.User.Where(s.query.User.ID.Eq(int32(id))).First()
	if err != nil {
		return nil, err
	}
	return user, nil
}

// à¹€à¸à¸´à¹ˆà¸¡ methods à¸­à¸·à¹ˆà¸™à¹† à¸•à¸²à¸¡à¸•à¹‰à¸­à¸‡à¸à¸²à¸£...`,
      language: "go",
      filename: "internal/services/user_service.go"
    },
    {
      title: "Step 8: internal/handlers/user_handler.go",
      icon: <Code className="w-5 h-5" />,
      description: "HTTP handlers (à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡)",
      code: `package handlers

import (
	"myproject/internal/services"
	"net/http"
	"strconv"

	"github.com/gin-gonic/gin"
)

type UserHandler struct {
	userService *services.UserService
}

func NewUserHandler(us *services.UserService) *UserHandler {
	return &UserHandler{userService: us}
}

// GET /users
func (h *UserHandler) GetUsers(c *gin.Context) {
	users, err := h.userService.GetAllUsers()
	if err != nil {
		c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
		return
	}
	c.JSON(http.StatusOK, users)
}

// GET /users/:id
func (h *UserHandler) GetUser(c *gin.Context) {
	id, err := strconv.Atoi(c.Param("id"))
	if err != nil {
		c.JSON(http.StatusBadRequest, gin.H{"error": "Invalid ID"})
		return
	}

	user, err := h.userService.GetUserByID(id)
	if err != nil {
		c.JSON(http.StatusNotFound, gin.H{"error": "User not found"})
		return
	}

	c.JSON(http.StatusOK, user)
}`,
      language: "go",
      filename: "internal/handlers/user_handler.go"
    },
    {
      title: "Step 9: cmd/api/main.go",
      icon: <Terminal className="w-5 h-5" />,
      description: "Main application entry point",
      code: `package main

import (
	"log"
	"myproject/config"
	"myproject/internal/database"
	"myproject/internal/handlers"
	"myproject/internal/models/query"
	"myproject/internal/services"

	"github.com/gin-gonic/gin"
)

func main() {
	// à¹‚à¸«à¸¥à¸” configuration
	cfg := config.Load()

	// à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ database
	if err := database.Connect(cfg); err != nil {
		log.Fatal("âŒ Failed to connect database:", err)
	}

	// Initialize query
	query.SetDefault(database.GetDB())
	q := query.Use(database.GetDB())

	// Initialize services
	userService := services.NewUserService(q)

	// Initialize handlers
	userHandler := handlers.NewUserHandler(userService)

	// Setup router
	r := gin.Default()

	// Routes
	api := r.Group("/api/v1")
	{
		api.GET("/users", userHandler.GetUsers)
		api.GET("/users/:id", userHandler.GetUser)
		// à¹€à¸à¸´à¹ˆà¸¡ routes à¸­à¸·à¹ˆà¸™à¹†...
	}

	// Start server
	log.Printf("ğŸš€ Server starting on port %s", cfg.App.Port)
	if err := r.Run(":" + cfg.App.Port); err != nil {
		log.Fatal("âŒ Failed to start server:", err)
	}
}`,
      language: "go",
      filename: "cmd/api/main.go"
    },
    {
      title: "Step 10: à¸ªà¸£à¹‰à¸²à¸‡ Makefile",
      icon: <FileCode className="w-5 h-5" />,
      description: "Commands à¸ªà¸³à¸«à¸£à¸±à¸š development",
      code: `.PHONY: help generate run build clean

help: ## à¹à¸ªà¸”à¸‡ help
	@echo "Available commands:"
	@echo "  make generate  - Generate GORM models"
	@echo "  make run       - Run application"
	@echo "  make build     - Build application"
	@echo "  make clean     - Clean build files"

generate: ## Generate GORM models à¸ˆà¸²à¸ database
	@echo "ğŸ”„ Generating models..."
	@go run scripts/generate.go

run: ## Run application
	@echo "ğŸš€ Starting application..."
	@go run cmd/api/main.go

build: ## Build application
	@echo "ğŸ”¨ Building..."
	@go build -o bin/api cmd/api/main.go

clean: ## Clean build files
	@echo "ğŸ§¹ Cleaning..."
	@rm -rf bin/`,
      language: "makefile",
      filename: "Makefile"
    },
    {
      title: "Step 11: à¸ªà¸£à¹‰à¸²à¸‡ .gitignore",
      icon: <FileCode className="w-5 h-5" />,
      description: "à¹„à¸Ÿà¸¥à¹Œà¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸„à¸§à¸£ commit",
      code: `# Environment variables
.env
.env.local

# Build output
bin/
dist/

# Go
*.exe
*.exe~
*.dll
*.so
*.dylib
*.test
*.out

# IDE
.idea/
.vscode/
*.swp
*.swo

# OS
.DS_Store
Thumbs.db`,
      language: "gitignore",
      filename: ".gitignore"
    }
  ];

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
      <div className="max-w-5xl mx-auto">
        {/* Header */}
        <div className="bg-white rounded-xl shadow-lg p-8 mb-6">
          <div className="flex items-center gap-3 mb-4">
            <Layers className="w-10 h-10 text-indigo-600" />
            <h1 className="text-3xl font-bold text-gray-800">Go Project Structure à¹à¸šà¸šà¸¡à¸²à¸•à¸£à¸à¸²à¸™</h1>
          </div>
          <p className="text-gray-600">
            Clean Architecture à¸à¸£à¹‰à¸­à¸¡ GORM Gen - à¸ˆà¸±à¸” structure à¸”à¸µà¹† à¹à¸šà¸šà¸¡à¸·à¸­à¸­à¸²à¸Šà¸µà¸
          </p>
        </div>

        {/* Project Structure */}
        <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
          <h3 className="font-semibold text-gray-800 mb-3 flex items-center gap-2">
            <FolderPlus className="w-5 h-5 text-indigo-600" />
            à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡ Project à¸—à¸µà¹ˆà¸ˆà¸°à¹„à¸”à¹‰
          </h3>
          <pre className="bg-gray-900 text-gray-100 p-4 rounded-lg text-sm overflow-x-auto">
{`myproject/
â”œâ”€â”€ .env                          # Environment variables
â”œâ”€â”€ .gitignore                    # Git ignore rules
â”œâ”€â”€ go.mod                        # Go modules
â”œâ”€â”€ go.sum
â”œâ”€â”€ Makefile                      # Build commands
â”‚
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ main.go              # ğŸš€ Application entry point
â”‚
â”œâ”€â”€ config/
â”‚   â””â”€â”€ config.go                # âš™ï¸ Configuration management
â”‚
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â””â”€â”€ database.go          # ğŸ’¾ Database connection
â”‚   â”‚
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ query/               # ğŸ“¦ Generated models (auto)
â”‚   â”‚       â”œâ”€â”€ gen.go
â”‚   â”‚       â”œâ”€â”€ users.gen.go
â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ handlers/                # ğŸ¯ HTTP handlers
â”‚   â”‚   â””â”€â”€ user_handler.go
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                # ğŸ’¼ Business logic
â”‚   â”‚   â””â”€â”€ user_service.go
â”‚   â”‚
â”‚   â””â”€â”€ middleware/              # ğŸ” Middleware
â”‚       â””â”€â”€ auth.go
â”‚
â”œâ”€â”€ pkg/
â”‚   â””â”€â”€ utils/                   # ğŸ› ï¸ Shared utilities
â”‚       â””â”€â”€ helpers.go
â”‚
â””â”€â”€ scripts/
    â””â”€â”€ generate.go              # ğŸ”„ Model generator script`}
          </pre>
          
          <div className="mt-4 p-4 bg-blue-50 rounded-lg">
            <p className="text-sm text-blue-900">
              <strong>ğŸ“š Architecture Pattern:</strong> Clean Architecture + Layered Architecture
            </p>
            <ul className="text-sm text-blue-800 mt-2 space-y-1">
              <li>â€¢ <strong>cmd/</strong> - Entry points à¹à¸¢à¸à¸•à¸²à¸¡ service</li>
              <li>â€¢ <strong>internal/</strong> - Private code à¸‚à¸­à¸‡ project</li>
              <li>â€¢ <strong>pkg/</strong> - Public code à¸—à¸µà¹ˆ share à¹„à¸”à¹‰</li>
              <li>â€¢ <strong>config/</strong> - Configuration centralized</li>
              <li>â€¢ <strong>scripts/</strong> - Automation scripts</li>
            </ul>
          </div>
        </div>

        {/* Steps */}
        <div className="space-y-4">
          {codeBlocks.map((block, index) => (
            <div key={index} className="bg-white rounded-xl shadow-lg overflow-hidden">
              <div className="bg-gradient-to-r from-indigo-600 to-blue-600 p-4 text-white">
                <div className="flex items-center gap-3">
                  {block.icon}
                  <div className="flex-1">
                    <h2 className="text-xl font-semibold">{block.title}</h2>
                    <p className="text-indigo-100 text-sm">{block.description}</p>
                  </div>
                  {block.filename && (
                    <span className="bg-white/20 px-3 py-1 rounded-full text-xs font-mono">
                      {block.filename}
                    </span>
                  )}
                </div>
              </div>
              
              <div className="relative">
                <button
                  onClick={() => copyToClipboard(block.code, index)}
                  className="absolute top-4 right-4 bg-gray-700 hover:bg-gray-600 text-white px-3 py-2 rounded-lg flex items-center gap-2 transition-colors z-10"
                >
                  {copiedIndex === index ? (
                    <>
                      <Check className="w-4 h-4" />
                      <span className="text-sm">Copied!</span>
                    </>
                  ) : (
                    <>
                      <Copy className="w-4 h-4" />
                      <span className="text-sm">Copy</span>
                    </>
                  )}
                </button>
                
                <pre className="bg-gray-900 text-gray-100 p-6 overflow-x-auto">
                  <code className="text-sm">{block.code}</code>
                </pre>
              </div>
            </div>
          ))}
        </div>

        {/* Quick Start */}
        <div className="bg-gradient-to-r from-green-50 to-emerald-50 border-l-4 border-green-500 rounded-lg p-6 mt-6">
          <h3 className="font-semibold text-green-900 mb-3">ğŸš€ Quick Start:</h3>
          <div className="space-y-2 text-sm">
            <div className="bg-white rounded p-3 font-mono text-green-800">
              <span className="text-gray-500"># 1. Generate models</span><br/>
              make generate
            </div>
            <div className="bg-white rounded p-3 font-mono text-green-800">
              <span className="text-gray-500"># 2. Run application</span><br/>
              make run
            </div>
            <div className="bg-white rounded p-3 font-mono text-green-800">
              <span className="text-gray-500"># 3. Test API</span><br/>
              curl http://localhost:8080/api/v1/users
            </div>
          </div>
        </div>

        {/* Best Practices */}
        <div className="bg-amber-50 border-l-4 border-amber-500 rounded-lg p-6 mt-4">
          <h3 className="font-semibold text-amber-900 mb-3">ğŸ’¡ Best Practices:</h3>
          <ul className="text-amber-800 space-y-2 text-sm">
            <li>â€¢ <strong>Separation of Concerns:</strong> à¹à¸¢à¸ layer à¸Šà¸±à¸”à¹€à¸ˆà¸™ (Handler â†’ Service â†’ Repository)</li>
            <li>â€¢ <strong>Dependency Injection:</strong> à¸ªà¹ˆà¸‡ dependencies à¸œà¹ˆà¸²à¸™ constructor</li>
            <li>â€¢ <strong>Error Handling:</strong> Return error à¹à¸—à¸™à¸à¸²à¸£ panic</li>
            <li>â€¢ <strong>Configuration:</strong> à¹ƒà¸Šà¹‰ environment variables à¹à¸—à¸™ hardcode</li>
            <li>â€¢ <strong>Database:</strong> Generate models à¹ƒà¸«à¸¡à¹ˆà¸—à¸¸à¸à¸„à¸£à¸±à¹‰à¸‡à¸—à¸µà¹ˆà¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™ schema</li>
            <li>â€¢ <strong>Version Control:</strong> Commit generated models à¹à¸•à¹ˆà¹„à¸¡à¹ˆ commit .env</li>
          </ul>
        </div>

        {/* Next Steps */}
        <div className="bg-blue-50 border-l-4 border-blue-500 rounded-lg p-6 mt-4">
          <h3 className="font-semibold text-blue-900 mb-3">ğŸ“ Next Steps:</h3>
          <ul className="text-blue-800 space-y-1 text-sm">
            <li>â€¢ à¹€à¸à¸´à¹ˆà¸¡ middleware à¸ªà¸³à¸«à¸£à¸±à¸š authentication, logging, CORS</li>
            <li>â€¢ à¹€à¸à¸´à¹ˆà¸¡ validation à¸”à¹‰à¸§à¸¢ go-playground/validator</li>
            <li>â€¢ à¹€à¸à¸´à¹ˆà¸¡ unit tests à¹ƒà¸™ services à¹à¸¥à¸° handlers</li>
            <li>â€¢ Setup Docker à¹à¸¥à¸° docker-compose</li>
            <li>â€¢ à¹€à¸à¸´à¹ˆà¸¡ API documentation à¸”à¹‰à¸§à¸¢ Swagger</li>
          </ul>
        </div>
      </div>
    </div>
  );
}